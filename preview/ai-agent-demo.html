<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Tech Content Agent — Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f8f9fa; }
    .container { max-width: 1100px; }
    .card { box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .demo-badge { font-size: 12px; }
    .list-group-item.active { background-color: #0d6efd; border-color: #0d6efd; }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h2 class="m-0">AI Tech Content Agent</h2>
      <span class="badge bg-secondary demo-badge">Demo tries backend first; falls back to mock</span>
    </div>

    <div class="alert alert-light py-2">
      Tip: set window.DEMO_API_BASE = 'http://127.0.0.1:8000' in DevTools, then reload.
    </div>

    <div id="root"></div>
  </div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useMemo, useState, useEffect } = React;

    const defaultHashtags = ["#G-TechRising", "#PlantHerTechFuture", "#RuralWomenInTech"];
    const API_BASE = ((window.DEMO_API_BASE || 'http://127.0.0.1:8000') + '/api');

    function AIAgentDemo() {
      const [tab, setTab] = useState("news");
      const [loading, setLoading] = useState(false);
      const [items, setItems] = useState([]);
      const [selected, setSelected] = useState(null);
      const [form, setForm] = useState({ title: "", summary: "", url: "", image: "", hashtags: defaultHashtags.join(" ") });
      const [message, setMessage] = useState("");

      const demoData = useMemo(() => ({
        news: [
          { type: "news", title: "African fintech raises new funding", summary: "A Nairobi-based fintech announced a seed extension to scale inclusive payments.", url: "https://example.com/africa-fintech", image: "https://placehold.co/600x320?text=Fintech", hashtags: defaultHashtags },
          { type: "news", title: "Egypt startup expands cloud services", summary: "Cairo startup launches regional cloud platform targeting SMEs across North Africa.", url: "https://example.com/egypt-cloud", image: "https://placehold.co/600x320?text=Cloud", hashtags: defaultHashtags }
        ],
        success: [
          { type: "success", title: "Female-founded healthtech hits profitability", summary: "Lagos healthtech reaches profitability after expanding to rural clinics.", url: "https://example.com/healthtech", image: "https://placehold.co/600x320?text=Healthtech", hashtags: defaultHashtags }
        ],
        events: [
          { type: "event", title: "Africa Tech Summit (Virtual, Free)", summary: "Join thought leaders discussing AI adoption across the continent.", url: "https://example.com/ats-virtual", image: "https://placehold.co/600x320?text=Summit", hashtags: defaultHashtags },
          { type: "event", title: "Women in Tech Africa Meetup — Accra", summary: "Community meetup focused on career pathways and mentorship.", url: "https://example.com/wita-accra", image: "https://placehold.co/600x320?text=Meetup", hashtags: defaultHashtags }
        ]
      }), []);

      useEffect(() => {
        let didCancel = false;
        setLoading(true);
        setMessage("");

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 6000);

        fetch(`${API_BASE}/ai/generate/?type=${tab}`, { signal: controller.signal })
          .then(async (res) => {
            if (!res.ok) throw new Error('bad_status');
            const data = await res.json();
            if (didCancel) return;
            setItems(data.items || []);
            setMessage("Loaded live data from backend");
          })
          .catch(() => {
            if (didCancel) return;
            setItems(demoData[tab] || []);
            setMessage("Loaded demo data (backend unavailable)");
          })
          .finally(() => {
            if (didCancel) return;
            clearTimeout(timeoutId);
            setLoading(false);
          });

        return () => { didCancel = true; clearTimeout(timeoutId); controller.abort(); };
      }, [tab, demoData]);

      const onSelect = (it) => {
        setSelected(it);
        setForm({
          title: it.title || "",
          summary: it.summary || "",
          url: it.url || "",
          image: it.image || "",
          hashtags: (it.hashtags || defaultHashtags).join(" ")
        });
      };

      const updateField = (k) => (e) => setForm((f) => ({ ...f, [k]: e.target.value }));

      const shareLinkedIn = () => {
        alert("Demo: Would share to LinkedIn with text and hashtags.\n\n" + `${form.title}\n\n${form.summary}\n\n${form.hashtags}`);
      };
      const shareInstagram = () => {
        alert("Demo: Would share to Instagram with image and caption.\n\n" + `${form.title}\n\n${form.summary}\n\n${form.hashtags}`);
      };

      return (
        <div>
          <div className="btn-group mb-3">
            <button className={`btn btn-outline-primary ${tab==='news'?'active':''}`} onClick={() => setTab('news')}>Tech News</button>
            <button className={`btn btn-outline-primary ${tab==='events'?'active':''}`} onClick={() => setTab('events')}>Tech Events</button>
            <button className={`btn btn-outline-primary ${tab==='success'?'active':''}`} onClick={() => setTab('success')}>Success Stories</button>
          </div>

          {loading && <div>Loading...</div>}
          {message && <div className="alert alert-info">{message}</div>}

          <div className="row">
            <div className="col-md-7 mb-3">
              <div className="list-group">
                {items.map((it, idx) => (
                  <button key={idx} className={`list-group-item list-group-item-action ${selected===it? 'active':''}`} onClick={() => onSelect(it)}>
                    <div className="d-flex w-100 justify-content-between">
                      <h5 className="mb-1">{it.title}</h5>
                      <small>{it.type}</small>
                    </div>
                    {it.image && <img alt="preview" src={it.image} style={{maxWidth:'100%', borderRadius:6, marginTop:6}} />}
                    <p className="mb-1 mt-2">{it.summary}</p>
                    <small>{it.url}</small>
                  </button>
                ))}
              </div>
            </div>

            <div className="col-md-5">
              <div className="card">
                <div className="card-body">
                  <h5 className="card-title">Edit & Approve</h5>
                  {form.image && <img alt="selected" src={form.image} style={{maxWidth:'100%', borderRadius:6, marginBottom:10}} />}
                  <input className="form-control mb-2" placeholder="Title" value={form.title} onChange={updateField('title')} />
                  <textarea className="form-control mb-2" rows={6} placeholder="Summary" value={form.summary} onChange={updateField('summary')} />
                  <input className="form-control mb-2" placeholder="URL" value={form.url} onChange={updateField('url')} />
                  <input className="form-control mb-2" placeholder="Image URL" value={form.image} onChange={updateField('image')} />
                  <input className="form-control mb-2" placeholder="Hashtags" value={form.hashtags} onChange={updateField('hashtags')} />
                  <div className="d-flex gap-2 mt-2">
                    <button className="btn btn-primary" onClick={shareLinkedIn}>Share to LinkedIn</button>
                    <button className="btn btn-danger" onClick={shareInstagram}>Share to Instagram</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<AIAgentDemo />);
  </script>
</body>
</html>